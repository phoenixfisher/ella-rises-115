<!-- DATE HELPER: Converts Database Date Object to "YYYY-MM-DDTHH:MM" string -->
<% 
    function formatForInput(dateObj) {
        if (!dateObj) return '';
        const d = new Date(dateObj);
        d.setMinutes(d.getMinutes() - d.getTimezoneOffset());
        return d.toISOString().slice(0, 16);
    }
%>

<div class="landing">
    <!-- Using hero-panel for the white card container -->
    <div class="hero-panel" style="max-width: 800px; margin: 0 auto;">
        <h2 style="color: var(--charcoal); margin-top: 0; margin-bottom: 2rem;">Edit Event: <%= event.eventname %></h2>

        <form action="/editEvent/<%= event.eventid %>" method="POST">
            
            <!-- SECTION 1: General Event Info -->
            <h4 style="color: var(--rose-deep); border-bottom: 2px solid var(--pink-light); padding-bottom: 10px; margin-bottom: 20px;">General Information</h4>
            
            <div style="margin-bottom: 1.5rem;">
                <label for="name">Event Name</label>
                <input type="text" id="name" name="name" value="<%= event.eventname %>" required>
            </div>

            <!-- CSS Grid for 2 columns -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 1.5rem;">
                <div>
                    <label for="type">Event Type</label>
                    <select id="type" name="type" style="width: 100%; padding: 10px; border: 2px solid var(--pink-light); border-radius: 8px; background: var(--white); font-size: 1rem;">
                        <option value="Workshop" <%= event.eventtype === 'Workshop' ? 'selected' : '' %>>Workshop</option>
                        <option value="Social" <%= event.eventtype === 'Social' ? 'selected' : '' %>>Social</option>
                        <option value="Fundraiser" <%= event.eventtype === 'Fundraiser' ? 'selected' : '' %>>Fundraiser</option>
                        <option value="Meeting" <%= event.eventtype === 'Meeting' ? 'selected' : '' %>>Meeting</option>
                    </select>
                </div>
                <div>
                    <label for="recurrence">Recurrence Pattern</label>
                    <select id="recurrence" name="recurrence" style="width: 100%; padding: 10px; border: 2px solid var(--pink-light); border-radius: 8px; background: var(--white); font-size: 1rem;">
                        <option value="None" <%= event.eventrecurrencepattern === 'None' ? 'selected' : '' %>>None (One-time)</option>
                        <option value="Weekly" <%= event.eventrecurrencepattern === 'Weekly' ? 'selected' : '' %>>Weekly</option>
                        <option value="Monthly" <%= event.eventrecurrencepattern === 'Monthly' ? 'selected' : '' %>>Monthly</option>
                        <option value="Annually" <%= event.eventrecurrencepattern === 'Annually' ? 'selected' : '' %>>Annually</option>
                    </select>
                </div>
            </div>

            <div style="margin-bottom: 1.5rem;">
                <label for="description">Description</label>
                <textarea id="description" name="description" rows="3" style="width: 100%; padding: 10px; border: 2px solid var(--pink-light); border-radius: 8px; background: var(--white); font-size: 1rem; font-family: inherit;"><%= event.eventdescription %></textarea>
            </div>

            <!-- SECTION 2: Schedule & Logistics -->
            <h4 style="color: var(--rose-deep); border-bottom: 2px solid var(--pink-light); padding-bottom: 10px; margin-bottom: 20px; margin-top: 2.5rem;">Schedule & Logistics</h4>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 1.5rem;">
                <div>
                    <label for="startTime">Start Date & Time</label>
                    <input type="datetime-local" id="startTime" name="startTime" 
                           value="<%= formatForInput(event.eventdatetimestart) %>" required>
                </div>
                <div>
                    <label for="endTime">End Date & Time</label>
                    <input type="datetime-local" id="endTime" name="endTime" 
                           value="<%= formatForInput(event.eventdatetimeend) %>" required>
                </div>
            </div>

            <div style="margin-bottom: 1.5rem;">
                <label for="location">Location</label>
                <input type="text" id="location" name="location" value="<%= event.eventlocation %>" required>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 1.5rem;">
                <div>
                    <label for="capacity">Max Capacity</label>
                    <input type="number" id="capacity" name="capacity" 
                           value="<%= event.eventdefaultcapacity %>">
                </div>
                <div>
                    <label for="deadline">Registration Deadline</label>
                    <input type="datetime-local" id="deadline" name="deadline"
                           value="<%= formatForInput(event.eventregistrationdeadline) %>">
                </div>
            </div>

            <div style="display: flex; gap: 15px; margin-top: 2rem;">
                <a href="/events" style="flex: 1; text-align: center;">
                    <button type="button" style="width: 100%; background: #ccc; color: var(--charcoal);">Cancel</button>
                </a>
                <div style="flex: 1;">
                    <button type="submit" style="width: 100%;">Save Changes</button>
                </div>
            </div>

        </form>
    </div>
</div>